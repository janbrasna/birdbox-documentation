{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Birdbox","text":"<p>Birdbox is a kit for building on-brand, easily editable microsites quickly.</p> <p>It was developed by the Marketing Engineering team to save us time and to put more control over content in the hands of the relevant project\u2019s teams.</p> <p>Birdbox aims to be a full-stack solution. It brings together three key aspects:</p> <pre><code>* A class-leading content management system: Wagtail\n\n* Mozila\u2019s design system for the web, [Protocol](https://protocol.mozilla.org), to help ensure the sites look and behave like Mozilla sites\n\n* Streamlined infrastructure setup.\n</code></pre> <p>This is a documentation-only repo. The codebase for the kit is at https://github.com/mozmeao/birdbox/</p>"},{"location":"#documentation-status","title":"Documentation status","text":"<p>Very early days</p>"},{"location":"#documentation-roadmap","title":"Documentation Roadmap","text":"<ul> <li>[ ] Move from simple Markdown to GH pages</li> <li>[ ] Document infra side, with examples</li> <li>[ ] Stand up demo site, running bleeding-edge Birdbox so that it's easy to see components in use</li> </ul>"},{"location":"#setup","title":"Setup","text":""},{"location":"#running-locally-for-development-of-birdbox-itself","title":"Running locally, for development of Birdbox itself","text":""},{"location":"#directly-on-your-machine","title":"Directly on your machine","text":"<p>This mode uses sqlite for the DB and stores uploaded media on your machine</p> <ul> <li>Install the <code>just</code> taskrunner (Docs here; spoiler: <code>brew install just</code>)</li> <li>Check out the repo</li> <li><code>cd</code> path/to/birdbox</li> <li> <p>Create then activate a virtual environment (<code>pyenv</code> + <code>pyenv-virtualenv</code> is recommended, but not required - see Bedrock docs for installation details). Python 3.11+ is required, which you can install with `pyenv install 3.11.3``</p> <p><code>pyenv virtualenv 3.11.3 birdbox pyenv activate birdbox</code></p> </li> <li> <p><code>just preflight</code> to install Python and JS dependencies, run migrations (against a simple SQLite DB for local dev), create a cache table</p> </li> <li>To make an admin user <code>just createsuperuser</code></li> <li>To run the local webpack bundler + django runserver: <code>just run-local</code> or <code>npm start</code> (both do the same thing)</li> <li>Go to http://localhost:8000 for the default Wagtail site, and http://localhost:8000/admin/ for the CMS UI</li> <li>Ideally you will now load in set of sample pages - see Local development tips, below</li> </ul> <p>Main Wagtail admin/editor docs are at https://guide.wagtail.org/en-latest/</p>"},{"location":"#on-your-machine-via-docker","title":"On your machine, via Docker","text":"<p>We expect most active development to happen directly on 'bare metal' but it's possible to build  and use Docker containers to run Birdbox locally, avoiding the virtualenv and local dependency steps.</p> <p>Dockerized Birdbox uses a separate Postgres container for its database, not sqlite, so does not (currently) support the exporting and importing of local state.</p> <ul> <li>Install the <code>just</code> taskrunner (Docs here; spoiler: <code>brew install just</code>)</li> <li>Have Docker desktop and Docker Compose installed</li> <li>Check out the repo</li> <li><code>cd</code> path/to/birdbox</li> <li>Build the needed containers: <code>docker-compose build assets app</code></li> <li>Run the app container: <code>docker-compose up app</code> then go to http://localhost:8080 -- note that at the moment you'll start with the default, empty, Wagtail site</li> </ul> <p>To run commands in the docker containers, there are a couple of convenience helpers:</p> <ul> <li><code>just docker-preflight</code> - the same preflighting steps as for local, just run in Docker</li> <li><code>just docker-shell</code> - run a bash shell in an already-running Docker container</li> <li><code>just docker-manage-py SOME_COMMAND</code> - run Django's manage.py script in the already-running docker container, with SOME_COMMAND passed as extra args. e.g. <code>just docker-manage-py makemigrations</code></li> </ul> <p>To that end, if you're setting up a new Docker build locally, you'll want to do the following just to get Wagtail running, but with no content. This is the equivalent of <code>just preflight</code>:</p> <pre><code>just docker-preflight\njust docker-manage-py createsuperuser\njust docker-manage-py bootstrap_footer\n</code></pre>"},{"location":"#cloud-storage-with-local-docker-build","title":"Cloud storage with local Docker build","text":"<p>When using Docker locally, it's possible to configure birdbox to use cloud storage, as we do on a deployed site.</p> <p>To do this, copy ./docker/envfiles/local.env.example as local.env and add the relevant env vars. The link in the example file to Django-storages documentation shows what to set and also links to how to get the GCS credentials. For local use of Docker with GCS, you'll need to put those credentiuals somewhere that the Docker container can reach them - that's what the local-credentials directory is for: copy the relevant JSON credentials into there and update the  <code>GOOGLE_APPLICATION_CREDENTIALS</code> var in `local.env`` file to match.</p> <p>Once that's done, it should Just Work.</p>"},{"location":"#sso-setup","title":"SSO setup","text":"<p>Full instructions to come, but if you want to use SSO for a deployed Birdbox site, you'll need to ask the IAM team to provision a new project for the appropriate domain and provide credentails for the Django app, which should be passed as the env vars <code>OIDC_RP_CLIENT_ID</code> and <code>OIDC_RP_CLIENT_SECRET</code> and ensure <code>USE_SSO_AUTH</code> is set to True in settings.</p> <p>Birdbox in SSO mode will not support 'drive by' user creation even if they have an @mozilla.com identity. Only users who already exist in the Wagtail admin as a User will be allowed to log in. This is done by shelling in to a fresh setup and using <code>python birdbox/manage.py createsuperuser</code></p>"},{"location":"#deployment-instructions","title":"Deployment instructions","text":"<p>TO COME</p>"},{"location":"#real-world-use-instructions","title":"Real-world use instructions","text":"<p>(i.e. making a new site using Birdbox as a template project)</p> <p>TO COME</p>"},{"location":"#local-development-tips","title":"Local development tips","text":""},{"location":"#how-to-import-and-export-local-data","title":"How To: import and export local data","text":"<p>For local development, we use sqlite as our database, in part because it makes it easier to give another developer a copy of your state, which they can load in to be able to work with the same content you have. This is particularly useful for code review.</p> <p>(Note that it's not just the database we need to share around: we also need media files that line up with the records in the relevant DB table.)</p> <ol> <li> <p>To export a zip file of your local DB and images:</p> <p><code>just export-local-data</code></p> <p>...and note where the zip file is generated. Send that file to a colleague as needed. Note that it is zipped but not password-protected.</p> </li> <li> <p>To load in a zip file of DB and image data</p> <p><code>just import-local-data /path/to/file.zip</code></p> <p>This will replace your DB file and load in all the images, overwriting existing files. Note that it does not drop image files that aren't in the zip of data.</p> </li> </ol>"},{"location":"#how-to-add-a-new-streamfield-component-based-on-a-protocol-component","title":"How To: Add a new StreamField component based on a Protocol component","text":"<p>(This assumes you know your way around Wagtail - if not, please at least review the Wagtail quick start)</p> <ol> <li>Define a new block in Python in <code>microsite/blocks.py</code> with the fields/content items that the Protocol component needs (eg title, description, image)</li> <li>Add a new HTML template fragment for the new block in <code>microsite/templates/blocks/</code><ul> <li>Base the markup on the HTML in the Protocol docs' examples</li> <li>Remember to circle back and reference the template in the Python block definition</li> </ul> </li> <li>If JS or CSS is needed for the component, configure webpack to build it - see <code>src/css/protocol/card.scss</code> as an example<ul> <li>Remember to circle back to the Python nlock definition to set the <code>frontend_media</code> property so that this CSS/JS gets included when needed</li> </ul> </li> <li>Find the page (in <code>microsite.models</code>) with a StreamField that you want the new component to be available in. Add it to the list of blocks that are available.</li> <li><code>make makemigrations</code> then <code>make migrate</code> to get the DB up to speed</li> <li>In the Wagtail CMS admin, amend an instance of the relevant page to use your new block - you should be able to see it in the live preview. Usually it takes a bit of tweaking to get the page to look as you intend.</li> <li>If you need to add custom CSS to override what's in Protocol, add to <code>src/css/birdbox-protocol-overrides.css</code></li> </ol>"},{"location":"about/","title":"About this project","text":"<p>Birdbox is a kit for building on-brand, easily editable microsites quickly.</p> <p>It was developed by the Marketing Engineering team to save us time and to put more control over content in the hands of the relevant project\u2019s teams.</p> <p>Birdbox aims to be a full-stack solution. It brings together three key aspects:</p> <ul> <li> <p>Wagtail: a class-leading content management system: Wagtail</p> </li> <li> <p>Protocol, Mozila\u2019s design system for the web, to help ensure the sites look and behave like Mozilla sites</p> </li> <li> <p>Streamlined infrastructure setup.</p> </li> </ul> <p>This is a documentation-only repo. The codebase for the kit is at https://github.com/mozmeao/birdbox/</p>"}]}